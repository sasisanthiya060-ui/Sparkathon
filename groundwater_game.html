<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Groundwater Guardian</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; background: linear-gradient(#cfe9ff, #e9f7ef); }
    header { padding:12px; display:flex; justify-content:space-between; align-items:center; background:rgba(0,0,0,0.05); }
    #gameArea { display:flex; gap:12px; padding:12px; }
    #canvasWrap { background: white; padding:8px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.08); }
    canvas { background: linear-gradient(#bfe7ff, #e6fbff); display:block; border-radius:8px; }
    #sidebar { width:300px; }
    .panel { background: rgba(255,255,255,0.9); padding:10px; border-radius:10px; margin-bottom:12px; box-shadow:0 4px 12px rgba(0,0,0,0.06); }
    button { padding:8px 12px; border-radius:8px; border:0; cursor:pointer; }
    .controls { display:flex; gap:8px; align-items:center; }
    .fact { font-size:14px; }
    .small { font-size:12px; color:#555; }
  </style>
</head>
<body>
  <header>
    <div>
      <h2 id="title">Groundwater Guardian</h2>
      <div class="small" id="subtitle">Catch water, save groundwater!</div>
    </div>
    <div class="controls">
      <label for="lang">Language</label>
      <select id="lang">
        <option value="en">English</option>
        <option value="ta">தமிழ்</option>
      </select>
      <button id="startBtn">Start</button>
      <button id="resetBtn">Reset</button>
    </div>
  </header>

  <div id="gameArea">
    <div id="canvasWrap" class="panel">
      <canvas id="gameCanvas" width="700" height="420"></canvas>
    </div>

    <div id="sidebar">
      <div class="panel">
        <div><strong id="scoreLabel">Score:</strong> <span id="score">0</span></div>
        <div class="small" id="levelLabel">Level: <span id="level">1</span></div>
      </div>

      <div class="panel">
        <div><strong id="factTitle">Did you know?</strong></div>
        <div id="fact" class="fact">Groundwater supplies about half of the world’s drinking water.</div>
      </div>

      <div class="panel">
        <div><strong id="tipsTitle">Conservation Tips</strong></div>
        <ul id="tipsList">
          <li id="tip1">Fix leaks to save water.</li>
          <li id="tip2">Use rainwater for gardening.</li>
          <li id="tip3">Avoid over-extraction of wells.</li>
        </ul>
      </div>

      <div class="panel small">
        Controls: Arrow keys to move bucket. Catch blue drops, avoid grey polluted drops.
      </div>
    </div>
  </div>

  <script>
    // --- Game text for both languages ---
    const TEXT = {
      en: {
        title: 'Groundwater Guardian',
        subtitle: 'Catch water, save groundwater!',
        start: 'Start',
        reset: 'Reset',
        factTitle: 'Did you know?',
        facts: [
          'Groundwater supplies about half of the world\'s drinking water.',
          'Rainwater recharge helps refill aquifers.',
          'Overuse of groundwater causes wells to dry up.'
        ],
        tipsTitle: 'Conservation Tips',
        tips: ['Fix leaks to save water.', 'Use rainwater for gardening.', 'Avoid over-extraction of wells.']
      },
      ta: {
        title: 'நீர்நிலைய பாதுகாவலர்',
        subtitle: 'தண்ணீரை பிடி, தரைக் நீரை காப்பாற்று!',
        start: 'தொடங்கு',
        reset: 'மீட்டமை',
        factTitle: 'உங்களுக்கு தெரியுமா?',
        facts: [
          'மக்கள் குடிநீரின் சுமார் பாதியை தரைநீர் வழங்குகிறது.',
          'மழைநீர் சேர்க்கை குடிமண்ணை புதுப்பிக்க உதவுகிறது.',
          'அதிகமாய் தரைநீர் எடுத்துக்கொள்ளுதல் உறவுகளை ஆற்றுகிறது.'
        ],
        tipsTitle: 'பாதுகாப்பு அறிவுரைகள்',
        tips: ['கசிவு திருத்துங்கள்.', 'உதவிக்கு மழைநீரை பயன்படுத்துங்கள்.', 'கிணற்றுகளை அதிகமாக பயன்படுத்தாதீர்கள்.']
      }
    };

    // DOM elements
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const langSelect = document.getElementById('lang');
    const scoreEl = document.getElementById('score');
    const levelEl = document.getElementById('level');
    const factEl = document.getElementById('fact');
    const titleEl = document.getElementById('title');
    const subtitleEl = document.getElementById('subtitle');
    const factTitleEl = document.getElementById('factTitle');
    const tipsTitleEl = document.getElementById('tipsTitle');
    const tipsList = document.getElementById('tipsList');

    let gameState = 'stopped'; // 'running'
    let score = 0;
    let level = 1;
    let drops = [];
    let lastSpawn = 0;
    let bucket = { x: canvas.width/2 - 40, y: canvas.height - 50, w: 80, h: 30 };
    let keys = {};
    let lang = 'en';

    function applyLanguage() {
      const t = TEXT[lang];
      titleEl.textContent = t.title;
      subtitleEl.textContent = t.subtitle;
      startBtn.textContent = t.start;
      resetBtn.textContent = t.reset;
      factTitleEl.textContent = t.factTitle;
      factEl.textContent = t.facts[Math.floor(Math.random()*t.facts.length)];
      tipsTitleEl.textContent = t.tipsTitle;
      tipsList.innerHTML = '';
      t.tips.forEach(tp => {
        const li = document.createElement('li'); li.textContent = tp; tipsList.appendChild(li);
      });
    }

    langSelect.addEventListener('change', (e)=>{ lang = e.target.value; applyLanguage(); });

    startBtn.addEventListener('click', ()=>{
      if (gameState !== 'running') startGame();
    });
    resetBtn.addEventListener('click', resetGame);

    document.addEventListener('keydown', e=>{ keys[e.key] = true; });
    document.addEventListener('keyup', e=>{ keys[e.key] = false; });

    function spawnDrop() {
      const x = Math.random()*(canvas.width-20)+10;
      const isClean = Math.random() < (0.75 - level*0.05); // more polluted as level increases
      drops.push({ x, y: -10, r: 8 + Math.random()*6, speed: 1.2 + Math.random()*1.6 + level*0.2, clean: isClean });
    }

    function update(dt) {
      // bucket movement
      if (keys['ArrowLeft'] || keys['a']) bucket.x -= 300*dt;
      if (keys['ArrowRight'] || keys['d']) bucket.x += 300*dt;
      bucket.x = Math.max(10, Math.min(canvas.width - bucket.w - 10, bucket.x));

      // spawn
      lastSpawn += dt;
      const spawnRate = Math.max(0.4, 1.4 - level*0.12);
      if (lastSpawn > spawnRate) { spawnDrop(); lastSpawn = 0; }

      // update drops
      for (let i = drops.length-1; i >= 0; i--) {
        const p = drops[i]; p.y += p.speed;
        // collision with bucket
        if (p.y + p.r > bucket.y && p.x > bucket.x && p.x < bucket.x + bucket.w) {
          if (p.clean) { score += 10; } else { score -= 6; }
          drops.splice(i,1);
        } else if (p.y - p.r > canvas.height) {
          // missed clean drop -> penalty
          if (p.clean) score -= 4;
          drops.splice(i,1);
        }
      }

      // level up every 200 points
      const newLevel = Math.max(1, Math.floor(score/200) + 1);
      if (newLevel !== level) { level = newLevel; factEl.textContent = TEXT[lang].facts[Math.floor(Math.random()*TEXT[lang].facts.length)]; }

      // clamp score
      score = Math.max(0, score);
    }

    function draw() {
      // background
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // draw water table (decorative)
      ctx.fillStyle = 'rgba(0,100,200,0.06)';
      ctx.fillRect(0, canvas.height - 60, canvas.width, 60);
      ctx.fillStyle = 'rgba(0,80,150,0.08)';
      ctx.fillRect(0, canvas.height - 38, canvas.width, 38);

      // draw bucket
      ctx.fillStyle = '#6b3';
      ctx.fillRect(bucket.x, bucket.y, bucket.w, bucket.h);
      ctx.strokeStyle = '#385'; ctx.strokeRect(bucket.x, bucket.y, bucket.w, bucket.h);

      // draw drops
      for (const p of drops) {
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
        if (p.clean) {
          ctx.fillStyle = 'rgba(45,120,255,0.9)';
          ctx.fill();
          // small shine
          ctx.fillStyle = 'rgba(255,255,255,0.5)'; ctx.fillRect(p.x-2, p.y-6, 4,2);
        } else {
          ctx.fillStyle = 'rgba(120,120,120,0.9)'; ctx.fill();
          ctx.fillStyle = 'rgba(255,255,255,0.35)'; ctx.fillRect(p.x-2, p.y-6, 4,2);
        }
      }

      // HUD
      ctx.fillStyle = '#000'; ctx.font = '18px Arial';
      ctx.fillText(TEXT[lang].start + ' ' + 'Score: ' + score, 12, 22);
    }

    let lastTime = 0;
    function loop(ts) {
      if (gameState !== 'running') return;
      if (!lastTime) lastTime = ts;
      const dt = (ts - lastTime)/1000; lastTime = ts;
      update(dt);
      draw();
      // update sidebar
      scoreEl.textContent = score;
      levelEl.textContent = level;
      requestAnimationFrame(loop);
    }

    function startGame() {
      score = 0; level = 1; drops = []; lastSpawn = 0; gameState = 'running'; lastTime = 0; applyLanguage(); requestAnimationFrame(loop);
    }
    function resetGame() { score = 0; level = 1; drops = []; lastSpawn = 0; gameState = 'stopped'; draw(); scoreEl.textContent = score; levelEl.textContent = level; }

    // initial language setup
    applyLanguage(); draw();

    // mobile: touch to move bucket
    canvas.addEventListener('touchmove', e=>{
      const t = e.touches[0]; const rect = canvas.getBoundingClientRect(); bucket.x = (t.clientX - rect.left) - bucket.w/2; e.preventDefault();
    }, { passive:false });

    // keyboard hints
    // Prevent arrow keys from scrolling page
    window.addEventListener('keydown', function(e) { if(['ArrowLeft','ArrowRight'].includes(e.key)) e.preventDefault(); });
  </script>
</body>
</html>
